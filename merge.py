import cv2
import numpy as np

# -------------------------------------
# 1) ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
# -------------------------------------
bg = cv2.imread("background.jpg")      # í–‰ì‚¬ì¥ ì‚¬ì§„
fg = cv2.imread("slide.png")           # ë„£ê³  ì‹¶ì€ PPT ì´ë¯¸ì§€

if bg is None:
    raise FileNotFoundError("background.jpg íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
if fg is None:
    raise FileNotFoundError("slide.png íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

# -------------------------------------
# 2) PPT ì´ë¯¸ì§€ ì›ë³¸ì˜ ë„¤ ëª¨ì„œë¦¬ ì¢Œí‘œ
# -------------------------------------
h, w = fg.shape[:2]
src = np.float32([
    [3, 163],      # ì¢Œìƒ
    [185, 200],      # ìš°ìƒ
    [3, 335],      # ìš°í•˜
    [185, 344]       # ì¢Œí•˜
])

# -------------------------------------
# 3) í–‰ì‚¬ì¥ ìŠ¤í¬ë¦° ë„¤ ëª¨ì„œë¦¬ ì¢Œí‘œ (ë„ˆì˜ ì‚¬ì§„ì— ë§ê²Œ ìˆ˜ì •í•´ì•¼ í•¨)
# â€» ì˜ˆì‹œ ê°’ â€” ë°˜ë“œì‹œ ë„¤ ì‚¬ì§„ì— ë§ê²Œ ìˆ˜ì •!!!
# -------------------------------------
dst = np.float32([
    [0, 0],      # ì¢Œìƒ
    [185, 0],    # ìš°ìƒ
    [3, 335],      # ìš°í•˜
    [0, 344]     # ì¢Œí•˜
])

# -------------------------------------
# 4) ì›ê·¼ ë³€í™˜ í–‰ë ¬ ìƒì„±
# -------------------------------------
M = cv2.getPerspectiveTransform(src, dst)

# -------------------------------------
# 5) PPT ì´ë¯¸ì§€ë¥¼ ìŠ¤í¬ë¦° í˜•íƒœë¡œ ë³€í™˜(Warp)
# -------------------------------------
warped = cv2.warpPerspective(fg, M, (bg.shape[1], bg.shape[0]))

# -------------------------------------
# 6) ë§ˆìŠ¤í¬ ìƒì„±í•˜ì—¬ ë°°ê²½ê³¼ í•©ì„±
# -------------------------------------
gray = cv2.cvtColor(warped, cv2.COLOR_BGR2GRAY)
_, mask = cv2.threshold(gray, 1, 255, cv2.THRESH_BINARY)

mask_inv = cv2.bitwise_not(mask)
bg_area = cv2.bitwise_and(bg, bg, mask=mask_inv)
final = cv2.add(bg_area, warped)

# -------------------------------------
# 7) ê²°ê³¼ ì €ì¥
# -------------------------------------
cv2.imwrite("final_result.jpg", final)

print("ğŸ‰ í•©ì„± ì™„ë£Œ! â†’ final_result.jpg ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
